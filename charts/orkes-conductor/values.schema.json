{
  "$schema": "http://json-schema.org/schema#",
  "type": "object",
  "required": [
    "service",
    "image",
    "workerImage",
    "app",
    "secrets",
    "workersConfig",
    "imageCredentials",
    "security"
  ],
  "properties": {
    "app": {
      "type": "object",
      "required": [
        "env",
        "archiveStoreType"
      ],
      "properties": {
        "replicaCount": {
          "type": "integer"
        },
        "env": {
          "type": "string",
          "enum": [
            "aws",
            "azure",
            "gcp"
          ]
        },
        "archiveStoreType": {
          "type": "string",
          "enum": [
            "azureblob",
            "gcp",
            "postgres",
            "s3"
          ]
        },
        "apiOrchestrationEnabled": {
          "type": "string",
          "enum": [
            "true",
            "false"
          ]
        },
        "grpcServerEnabled": {
          "type": "string",
          "enum": [
            "true",
            "false"
          ]
        },
        "secretsType": {
          "type": "string",
          "enum": [
            "azkv",
            "gcp",
            "memory",
            "ssm"
          ]
        }
      }
    },
    "secrets": {
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "azkv",
            "gcp",
            "memory",
            "ssm"
          ]
        },
        "ssmPath": { "type": "string" },
        "gsmPath": { "type": "string" }
      }
    },
    "serviceAccount": {
      "type": "object",
      "properties": {
        "annotations": { "type": "object" }
      }
    },
    "server": {
      "type": "object",
      "properties": {
        "name": { "type": "string" },
        "image": {
          "type": "object",
          "properties": {
            "repository": { "type": "string" },
            "tag": { "type": "string" },
            "pullPolicy": { "type": "string" }
          }
        },
        "livenessPort": { "type": "integer" }
      }
    },
    "workers": {
      "type": "object",
      "properties": {
        "name": { "type": "string" },
        "image": {
          "type": "object",
          "properties": {
            "repository": { "type": "string" },
            "tag": { "type": "string" },
            "pullPolicy": { "type": "string" }
          }
        }
      }
    },
    "workersConfig": {
      "type": "object",
      "required": [
        "replicaCount"
      ],
      "properties": {
        "replicaCount": {
          "type": "integer"
        },
        "accessKeyId": { "type": ["string", "null"] },
        "accessKeySecret": { "type": ["string", "null"] },
        "springProfilesActive": { "type": "string" },
        "blockIps": { "type": "string" },
        "jvmSettings": { "type": "string" },
        "env": { "type": "object" },
        "resources": {
          "type": "object",
          "properties": {
            "cpuLimit": { "type": "string" },
            "memoryLimit": { "type": "string" },
            "cpuRequests": { "type": "string" },
            "memoryRequests": { "type": "string" }
          }
        }
      }
    },
    "redis": {
      "type": "object",
      "properties": {
        "host": { "type": "string" },
        "port": { "type": ["integer", "string"] },
        "ssl": { "type": "boolean" },
        "sslEnabled": { "type": "boolean" },
        "password": { "type": "string" },
        "username": { "type": "string" },
        "dbIndex": { "type": "integer" },
        "clusterMode": { "type": "boolean" },
        "zoneSuffix": { "type": "string" },
        "maxConnections": { "type": "integer" },
        "minIdleConnections": { "type": "integer" },
        "connectionTimeout": { "type": "integer" }
      }
    },
    "postgres": {
      "type": "object",
      "properties": {
        "host": { "type": "string" },
        "port": { "type": "integer" },
        "database": { "type": "string" },
        "username": { "type": "string" },
        "password": { "type": "string" },
        "url": { "type": "string" },
        "ssl": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean" },
            "mode": { "type": "string" },
            "cert": { "type": "string" },
            "key": { "type": "string" },
            "rootCert": { "type": "string" }
          }
        },
        "maxPoolSize": { "type": "integer" },
        "minPoolSize": { "type": "integer" },
        "connectionTimeout": { "type": "integer" }
      }
    },
    "vault": {
      "type": "object",
      "properties": {
        "enabled": { "type": "boolean" },
        "server": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean" },
            "role": { "type": "string" },
            "path": { "type": "string" },
            "secretPath": { "type": "string" },
            "serviceAccount": { "type": "string" },
            "annotations": { "type": "object" },
            "envSecrets": { "type": "object" }
          }
        },
        "workers": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean" },
            "role": { "type": "string" },
            "path": { "type": "string" },
            "secretPath": { "type": "string" },
            "serviceAccount": { "type": "string" },
            "annotations": { "type": "object" },
            "envSecrets": { "type": "object" }
          }
        }
      }
    },
    "customImagePullSecrets": {
      "type": "object",
      "properties": {
        "enabled": { "type": "boolean" },
        "name": { "type": "string" },
        "registries": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "registry": { "type": "string" },
              "username": { "type": "string" },
              "password": { "type": "string" },
              "email": { "type": "string" }
            }
          }
        }
      }
    },
    "existingImagePullSecret": { "type": "string" },
    "imageCredentials": {
      "type": "object",
      "required": [
        "registry",
        "username",
        "password",
        "email"
      ],
      "properties": {
        "registry": {
          "type": "string"
        },
        "username": {
          "type": "string"
        },
        "password": {
          "type": "string"
        },
        "email": {
          "type": "string"
        }
      }
    },
    "security": {
      "type": "object",
      "required": [
        "enabled",
        "overwriteDefault",
        "defaultUserEmail",
        "defaultUserName",
        "jwt"
      ],
      "properties": {
        "enabled": {
          "type": ["boolean", "string"]
        },
        "type": {
          "type": "string",
          "enum": [
            "auth0",
            "oidc"
          ]
        },
        "overwriteDefault": {
          "type": "boolean"
        },
        "jwt": {
          "type": "object",
          "properties": {
            "secret": {
              "type": "string"
            }
          }
        },
        "auth0": {
          "type": [
            "object"
          ],
          "required" : [
            "clientId",
            "domain"
          ],
          "properties": {
            "useIdToken": {
              "type": ["boolean", "string"]
            },
            "clientId": {
              "type": "string"
            },
            "domain": {
              "type": "string"
            }
          }
        },
        "oidc": {
          "type": [
            "object"
          ],
          "required": [
            "clientId",
            "audience",
            "metadataUrl"
          ],
          "properties": {
            "clientId": {
              "type": "string"
            },
            "audience": {
              "type": "string"
            },
            "metadataUrl": {
              "type": "string"
            }
          }
        }
      }
    }
  }
}
